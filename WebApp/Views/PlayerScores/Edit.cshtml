@model WebApp.ViewModels.ScoreCarddto

@{
    ViewData["Title"] = "Add a Match Score";
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Xsrf
@functions{
    public string GetAntiXsrfRequestToken()
    {
        return Xsrf.GetAndStoreTokens(Context).RequestToken;
    }
}


<input type="hidden" id="RequestVerificationToken"
       name="RequestVerificationToken" value="@GetAntiXsrfRequestToken()">

<div class="container-fluid">
    <div class="row">
        <section>
            <div class="wizard">
                <div class="wizard-inner">
                    <div class="connecting-line"></div>
                    <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active">
                            <a href="#step1" data-toggle="tab" aria-controls="step1" role="tab" title="First Inning">
                                <span class="round-tab">
                                    <i class="fas fa-globe-americas"></i>
                                </span>
                            </a>
                        </li>
                        <li role="presentation">
                            <a href="#step2" data-toggle="tab" aria-controls="step2" role="tab" title="Second Inning">
                                <span class="round-tab">
                                    <i class="fas fa-globe-africa"></i>
                                </span>
                            </a>
                        </li>
                        <li role="presentation">
                            <a href="#complete" data-toggle="tab" aria-controls="complete" role="tab" title="Match Summary">
                                <span class="round-tab">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" role="tabpanel" id="step1">
                        <div class="container-fluid">
                            <div class="col-sm-2">
                                <select asp-items="ViewBag.HomeTeam" disabled="disabled" style="width: 100%" class="js-example-basic-single"></select>
                            </div>
                            <hr />
                            <form class="form-inline" role="form" id="HomeTeamData">

                                <div class="form-inline">

                                    <div class="col-sm-1">

                                        <label class="control-label">S.No</label>

                                    </div>
                                    <div class="col-sm-1">

                                        <label class="control-label">Inning</label>

                                    </div>

                                    <div class="col-sm-4">

                                        <label class="control-label">Players</label>

                                    </div>
                                    <div class="col-sm-2">

                                        <label class="control-label">How Out</label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <label class="control-label">Bowler</label>
                                </div>

                                @{

                                    for (int i = 0; i < 12; i++)
                                    {

                                        <div class="row">
                                            <input type="hidden" asp-for="@Model.HomeTeamScoreCard[i].MatchId" />
                                            <input type="hidden" asp-for="@Model.HomeTeamScoreCard[i].PlayerScoreId" />
                                            <div class="col-sm-1">
                                                @{
                                                    var position = i + 1;
                                                    <label>@position</label>
                                                    <input readonly="readonly" style="display:none;" value="@position" asp-for="@Model.HomeTeamScoreCard[i].Position" />
                                                }
                                            </div>
                                            <div class="col-sm-1">
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" asp-for="@Model.HomeTeamScoreCard[i].IsPlayedInning" value="true">
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <select asp-for="@Model.HomeTeamScoreCard[i].PlayerId" asp-items="ViewBag.HomePlayerId" placeholder="--Select Player--" style="width: 100%" class="js-example-basic-single">
                                                    <option value="">--Select Player--</option>
                                                </select>
                                            </div>
                                            <div class="col-sm-2">
                                                <select asp-for="@Model.HomeTeamScoreCard[i].HowOut" placeholder="--How Out--" style="width: 100%" class="js-example-basic-single">
                                                    <option value="">--How Out--</option>
                                                    <option>Catch</option>
                                                    <option>Bowled</option>
                                                    <option>Stump</option>
                                                    <option>RunOut</option>
                                                    <option>Hit Wicket</option>
                                                    <option>LBW</option>
                                                    <option>Not Out</option>
                                                </select>
                                            </div>

                                            <div class="col-sm-4">
                                                <select asp-for="@Model.HomeTeamScoreCard[i].Bowler" asp-items="ViewBag.OpponentPlayerId" placeholder="--Select Player--" style="width: 100%" class="js-example-basic-single">
                                                    <option value="">--Select Bowler--</option>
                                                </select>
                                            </div>
                                        </div>
                                    }
                                }
                                <hr />

                                <ul class="list-inline pull-right">
                                    <li><input type="button" id="HomeTeamBtn" value="Save and Continue" class="btn btn-primary next-step" onclick="return HomeTeam(this.form)"></li>
                                </ul>

                            </form>
                        </div>
                    </div>
                    <div class="tab-pane" role="tabpanel" id="step2">

                        <div class="container-fluid">
                            <div class="col-sm-2">
                                <select asp-items="ViewBag.OpponentTeam" disabled="disabled" class="js-example-basic-single"></select>
                            </div>

                            <hr />
                            <form class="form-inline" role="form" id="OpponentTeam">

                                <div class="form-inline">

                                    <div class="col-sm-1">

                                        <label class="control-label">S.No</label>

                                    </div>
                                    <div class="col-sm-1">

                                        <label class="control-label">Inning</label>

                                    </div>

                                    <div class="col-sm-4">

                                        <label class="control-label">Players</label>

                                    </div>
                                    <div class="col-sm-2">

                                        <label class="control-label">How Out</label>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <label class="control-label">Bowler</label>
                                </div>

                                @{

                                    for (int i = 0; i < 12; i++)
                                    {

                                        <div class="row">
                                            <input type="hidden" asp-for="@Model.OpponentTeamScoreCard[i].MatchId" />
                                            <input type="hidden" asp-for="@Model.OpponentTeamScoreCard[i].PlayerScoreId" />
                                            <div class="col-sm-1">
                                                @{
                                                    var position = i + 1;
                                                    <label>@position</label>
                                                    <input readonly="readonly" style="display:none;" value="@position" asp-for="@Model.OpponentTeamScoreCard[i].Position" />
                                                }
                                            </div>
                                            <div class="col-sm-1">
                                                <div class="checkbox">
                                                    <label>
                                                        <input type="checkbox" asp-for="@Model.OpponentTeamScoreCard[i].IsPlayedInning" value="true">
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-sm-4">
                                                <select asp-for="@Model.OpponentTeamScoreCard[i].PlayerId" asp-items="ViewBag.OpponentPlayerId" placeholder="--Select Player--" style="width: 100%" class="js-example-basic-single">
                                                    <option value="">--Select Player--</option>
                                                </select>
                                            </div>
                                            <div class="col-sm-2">
                                                <select asp-for="@Model.OpponentTeamScoreCard[i].HowOut" placeholder="--How Out--" style="width: 100%" class="js-example-basic-single">
                                                    <option value="">--How Out--</option>
                                                    <option>Catch</option>
                                                    <option>Bowled</option>
                                                    <option>Stump</option>
                                                    <option>RunOut</option>
                                                    <option>Hit Wicket</option>
                                                    <option>LBW</option>
                                                    <option>Not Out</option>
                                                </select>
                                            </div>

                                            <div class="col-sm-4">
                                                <select asp-for="@Model.OpponentTeamScoreCard[i].Bowler" asp-items="ViewBag.HomePlayerId" placeholder="--Select Player--" style="width: 100%" class="js-example-basic-single">
                                                    <option value="">--Select Player--</option>
                                                </select>
                                            </div>
                                        </div>
                                    }
                                }
                                <ul class="list-inline pull-right">
                                    <li><input type="button" value="Previous" class="btn btn-default prev-step"></li>
                                    <li><input type="button" id="OpponentTeamBtn" value="Save and Continue" class="btn btn-primary next-step" onclick="return OpponentTeam(this.form)"></li>
                                </ul>
                            </form>
                        </div>

                    </div>
                    <div class="tab-pane" role="tabpanel" id="complete">
                        <form class="form-inline" role="form" id="MatchSummary">

                            @{

                                for (int i = 0; i < 2; i++)
                                {

                                    <div class="row">
                                        <input type="hidden" asp-for="@Model.TeamScoreCard[i].TeamScoreId" />
                                        <input type="hidden" asp-for="@Model.TeamScoreCard[i].MatchId" />
                                        <div class="col-sm-1">

                                            @{
                                                if (i < 1)
                                                {

                                                    <label>1st Inning Played by</label>
                                                }
                                                else
                                                {
                                                    <label>2nd Inning Played by</label>
                                                }

                                            }
                                        </div>

                                        <div class="col-sm-2">
                                            @{
                                                if (i < 1)
                                                {

                                                    <select asp-for="@Model.TeamScoreCard[i].TeamId" asp-items="ViewBag.HomeTeam" style="width: 100%" disabled="disabled" class="js-example-basic-single"></select>
                                                }
                                                else
                                                {
                                                    <select asp-for="@Model.TeamScoreCard[i].TeamId" asp-items="ViewBag.OpponentTeam" style="width: 100%" disabled="disabled" class="js-example-basic-single"></select>
                                                }

                                            }
                                        </div>
                                        <div class="col-sm-1">
                                            @{
                                                if (i < 1)
                                                {

                                                    <label>Set-up Target</label>
                                                }
                                                else
                                                {
                                                    <label>Has Made While Chasing</label>
                                                }

                                            }

                                        </div>
                                        <div class="col-sm-1">
                                            <input asp-for="@Model.TeamScoreCard[i].TotalScore" style="width: 50px" />
                                        </div>

                                        <div class="col-sm-2">
                                            <label>Given Extras While Bowling</label>
                                        </div>
                                        <div class="col-sm-1">
                                            <div class="col-sm-6">
                                                <label>Byes</label>
                                            </div>
                                            <div class="col-sm-6">
                                                <input asp-for="@Model.TeamScoreCard[i].Byes" required style="width: 50px" />
                                            </div>
                                        </div>
                                        <div class="col-sm-1">
                                            <div class="col-sm-6">
                                                <label>Leg-Byes</label>
                                            </div>
                                            <div class="col-sm-6">
                                                <input asp-for="@Model.TeamScoreCard[i].LegByes" required style="width: 50px" />
                                            </div>
                                        </div>
                                        <div class="col-sm-1">
                                            <div class="col-sm-6">
                                                <label> No-Balls</label>
                                            </div>
                                            <div class="col-sm-6">
                                                <input asp-for="@Model.TeamScoreCard[i].NoBalls" required style="width: 50px" />
                                            </div>
                                        </div>
                                        <div class="col-sm-1">
                                            <div class="col-sm-6">
                                                <label>Wide-Balls</label>
                                            </div>
                                            <div class="col-sm-6">
                                                <input asp-for="@Model.TeamScoreCard[i].Wideballs" required style="width: 50px" />
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            <ul class="list-inline pull-right">
                                <li><input type="button" value="Previous" class="btn btn-default prev-step"></li>
                                <li><input type="button" id="TeamScorebtn" value="Finish" class="btn btn-primary next-step" onclick="return TeamScoreData(this.form)"></li>
                            </ul>
                        </form>

                        <div class="container text-center">
                            <div>
                                <button id="BackBtn" class="btn btn-primary btn-xs">Finish</button>
                            </div>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </section>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap-wizard/1.2/jquery.bootstrap.wizard.min.js"></script>
    <script>
        $(document).ready(function () {
            $('.js-example-basic-single').select2();
        });
        const globalStates = [];
        $(function () {
            $('#BackBtn').click(function () {
                window.location = '/Matches/Index'
            });
        });
        const openModal = (id) => {
            document.getElementById('Modal_PlayerId').value = document.getElementById(`Grid_${id}__PlayerId`).value;
        };


        function HomeTeam() {
            try {
                var formData = $("#HomeTeamData").serializeArray();
                var model = {
                    matchScore: []
                };

                for (let index = 0; index < 12; index++) {
                    const currentModel = formData.filter(i => i.name.includes(`[${index}]`));
                    var matchScore = {};
                    for (let i = 0; i < currentModel.length; i++) {
                        const indexOfBracket = currentModel[i].name.indexOf(']') + 2;
                        matchScore[currentModel[i].name.substring(indexOfBracket)] = currentModel[i].value;
                    }
                    model.matchScore.push(matchScore);
                }

                console.log(model);
                $.ajax(`/PLayerScores/Edit`, {
                    data: model,
                    headers: {
                        'RequestVerificationToken': document.getElementById("RequestVerificationToken").value,
                    },
                    method: "POST"
                }).done(function (response) {
                    if (!response.ok) {
                        alert("Record updated successfully");
                    }
                }).fail(function () {
                    alert("Record can not be updated");
                });


            } catch (ex) {
                console.error(ex);
            }

        }

        function OpponentTeam() {
            try {

                var formData = $("#OpponentTeamData").serializeArray();
                var model = {
                    matchScore: []
                };
                for (let index = 0; index < 12; index++) {
                    const currentModel = formData.filter(i => i.name.includes(`[${index}]`));
                    var matchScore = {};
                    for (let i = 0; i < currentModel.length; i++) {
                        const indexOfBracket = currentModel[i].name.indexOf(']') + 2;
                        matchScore[currentModel[i].name.substring(indexOfBracket)] = currentModel[i].value;
                    }
                    model.matchScore.push(matchScore);
                }
                console.log(model);
                $.ajax(`/PLayerScores/Edit`, {
                    data: formData,
                    headers: {
                        'RequestVerificationToken': document.getElementById("RequestVerificationToken").value,
                    },
                    method: "POST"
                }).done(function (response) {
                    if (!response) {
                        alert("Record updated successfully");
                    }
                }).fail(function () {
                    alert("Record can not be updated");
                });

            } catch (ex) {
                console.error(ex);
            }

        }

        function TeamScoreData() {
            try {
                var formData = $("#MatchSummary").serializeArray();
                var model = {
                    teamScore: []
                };
                for (let index = 0; index < 2; index++) {
                    const currentModel = formData.filter(i => i.name.includes(`[${index}]`));
                    var teamScore = {};
                    for (let i = 0; i < currentModel.length; i++) {
                        const indexOfBracket = currentModel[i].name.indexOf(']') + 2;
                        teamScore[currentModel[i].name.substring(indexOfBracket)] = currentModel[i].value;
                    }
                    model.teamScore.push(teamScore);
                }
                console.log(model);
                $.ajax(`/PLayerScores/UpdateTeamScore`, {
                    data: formData,
                    headers: {
                        'RequestVerificationToken': document.getElementById("RequestVerificationToken").value,
                    },
                    method: "POST"
                }).done(function (response) {
                    if (!response) {
                        alert("Record inserted successfully");
                    }
                }).fail(function () {
                    alert("Record can not be inserted");
                });

            } catch (ex) {
                console.error(ex);
            }

        }

        $(document).ready(function () {
            //Initialize tooltips
            $('.nav-tabs > li a[title]').tooltip();

            //Wizard
            $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {

                var $target = $(e.target);

                if ($target.parent().hasClass('disabled')) {
                    return false;
                }
            });

            $(".next-step").click(function (e) {

                var $active = $('.wizard .nav-tabs li.active');
                $active.next().removeClass('disabled');
                nextTab($active);

            });
            $(".prev-step").click(function (e) {

                var $active = $('.wizard .nav-tabs li.active');
                prevTab($active);

            });
        });

        function nextTab(elem) {
            $(elem).next().find('a[data-toggle="tab"]').click();
        }
        function prevTab(elem) {
            $(elem).prev().find('a[data-toggle="tab"]').click();
        }


    </script>
}

