@model IdentityDemo.Models.AccountViewModels.LoginViewModel
@{
    Layout = "_LoginLayout";
}

<div class="login-box">
    <div class="login-logo">
        <a href="../../index2.html"><b>Score</b>Exec</a>
    </div>
    <!-- /.login-logo -->
    <div class="login-box-body">
        <p class="login-box-msg">Sign in to start your session</p>
        <form asp-action="Login" method="post">
            <div class="form-group has-feedback">
                <input type="email" class="form-control" asp-for="Email" placeholder="Email">
                <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
            </div>
            <div class="form-group has-feedback">
                <input type="password" class="form-control" asp-for="Password" placeholder="Password">
                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
            </div>
            <div class="row">
                <div class="col-xs-8">
                    <div class="checkbox icheck">
                        <label>
                            <input asp-for="RememberMe" type="checkbox"> Remember Me
                        </label>
                    </div>
                </div>
                <!-- /.col -->
                <div class="col-xs-4">
                    <button type="submit" class="btn btn-primary btn-block btn-flat">Sign In</button>
                </div>
                <!-- /.col -->
            </div>
        </form>
      
        <!-- /.social-auth-links -->
        <a href="#">I forgot my password</a><br>
        <a id="Register" style="cursor: pointer" class="text-center">Register a new membership</a>
    </div>
    <!-- /.login-box-body -->
</div>
@section scripts {
    <link rel="stylesheet" href="../../plugins/iCheck/square/blue.css">
    <script src="../../plugins/iCheck/icheck.min.js"></script>
    <script>
        $(function () {
            $('input').iCheck({
                checkboxClass: 'icheckbox_square-blue',
                radioClass: 'iradio_square-blue',
                increaseArea: '20%' /* optional */
            });
        });

        $('#Register').click(function(){
            $(function () {
                window.location = '/Account/Register'
            });
        
        })
    

        var headers = new Headers();
        headers.append("content-type", "application/json");

        function validateEmail(email) {
            var re = /^(([^<>()\[\]\\.,;:\s@@"]+(\.[^<>()\[\]\\.,;:\s@@"]+)*)|(".+"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }


        $(function () {
            $('#SignInBtn').click((event) => {
                event.preventDefault();
                const email = $('#Email').val();
                const password = $('#Password').val();
                if (validateEmail(email)) {
                    fetch(`/Login/IsEmailMatch?email=${email}&password=${password}`, {
                        method: "GET",
                        credentials: 'same-origin',
                        headers: headers
                    }).then(res => {
                        const body = res.json().then(data => {
                            if (data) {
                                $(function () {
                                    window.location = '/Home/Index'
                                });
                            }
                            else {

                                document.getElementById("EmailError").innerHTML = "Invalid user or password";
                                return;
                            }

                        })
                    });
                }
            });
        });


        $('#Email').blur(function () {

            const email = $('#Email').val();
            if (!validateEmail(email)) {
                document.getElementById("EmailError").style.color = "#FF0000";
                document.getElementById("EmailError").innerHTML = "Please insert a valid email";
            }
            else {
                document.getElementById("EmailError").style.color = "#32CD32";
                document.getElementById("EmailError").innerHTML = "valid";

            }

            return;
        });
    </script>
}